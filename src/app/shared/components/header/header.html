<header class="bg-white border-b border-gray-200 sticky top-0 z-50">
  <nav class="max-w-7xl mx-auto px-6 h-16 flex justify-between items-center" role="navigation">
    
    <!-- Hamburger Button for Mobile -->
    <button 
      *ngIf="(user$ | async)"
      (click)="onToggleSidebar()"
      class="lg:hidden p-2 text-gray-600 hover:text-blue-600 hover:bg-gray-100 rounded-lg transition-colors mr-3">
      <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path>
      </svg>
    </button>
    
    <div class="shrink-0">
      <a routerLink="/" class="flex items-center gap-2 group">
        <i class="pi pi-shield text-2xl text-blue-600 group-hover:text-blue-700 transition-colors"></i>
        <span class="text-xl font-bold tracking-tight text-gray-900 group-hover:text-blue-700 transition-colors">
          RestO'Sure
        </span>
      </a>
    </div>

    <ul class="hidden md:flex items-center gap-8">
      <li>
        <a routerLink="/" 
           routerLinkActive="text-blue-600 font-semibold" 
           [routerLinkActiveOptions]="{exact: true}"
           class="text-gray-600 hover:text-blue-600 transition-colors font-medium text-sm">
           Home
        </a>
      </li>
      
      @if (user$ | async; as user) {
        <ng-container *appHasRole="['ROLE_USER']">
          <li>
            <a routerLink="/public/hospitals" 
               routerLinkActive="text-blue-600 font-semibold"
               class="text-gray-600 hover:text-blue-600 transition-colors font-medium text-sm">
               Find Hospital
            </a>
          </li>
          <li>
            <a routerLink="/member/dashboard" 
               routerLinkActive="text-blue-600 font-semibold"
               class="text-gray-600 hover:text-blue-600 transition-colors font-medium text-sm">
               My Dashboard
            </a>
          </li>
        </ng-container>

        <ng-container *appHasRole="['ROLE_ADMIN']">
          <li>
            <a routerLink="/admin/dashboard" 
               routerLinkActive="text-blue-600 font-semibold"
               class="text-gray-600 hover:text-blue-600 transition-colors font-medium text-sm">
               Admin Panel
            </a>
          </li>
        </ng-container>

        <ng-container *appHasRole="['ROLE_AGENT']">
          <li>
            <a routerLink="/agent/dashboard" 
               routerLinkActive="text-blue-600 font-semibold"
               class="text-gray-600 hover:text-blue-600 transition-colors font-medium text-sm">
               Agent Portal
            </a>
          </li>
        </ng-container>

        <ng-container *appHasRole="['ROLE_PROVIDER']">
          <li>
            <a routerLink="/provider/dashboard" 
               routerLinkActive="text-blue-600 font-semibold"
               class="text-gray-600 hover:text-blue-600 transition-colors font-medium text-sm">
               Provider Portal
            </a>
          </li>
        </ng-container>

        <ng-container *appHasRole="['ROLE_CLAIMS_OFFICER']">
          <li>
            <a routerLink="/claims/dashboard" 
               routerLinkActive="text-blue-600 font-semibold"
               class="text-gray-600 hover:text-blue-600 transition-colors font-medium text-sm">
               Claims Portal
            </a>
          </li>
        </ng-container>
      }
    </ul>

    <div class="flex items-center gap-4">
      @if (user$ | async; as user) {
        <!-- Profile Photo Dropdown -->
        <div class="relative">
          <button 
            (click)="toggleDropdown()"
            class="w-10 h-10 rounded-full overflow-hidden border-2 border-gray-200 hover:border-blue-400 transition-all focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2">
            @if (userPhotoUrl()) {
              <img [src]="userPhotoUrl()" 
                   [alt]="user.name"
                   class="w-full h-full object-cover">
            } @else {
              <div class="w-full h-full bg-blue-100 flex items-center justify-center text-blue-600 font-semibold text-sm">
                {{ user.name.charAt(0).toUpperCase() || 'U' }}
              </div>
            }
          </button>

          <!-- Dropdown Menu -->
          @if (isDropdownOpen()) {
            <!-- Backdrop for mobile -->
            <div 
              (click)="closeDropdown()"
              class="fixed inset-0 z-10 md:hidden">
            </div>

            <!-- Dropdown Content -->
            <div class="absolute right-0 mt-2 w-56 rounded-lg shadow-lg bg-white ring-1 ring-black ring-opacity-5 z-20">
              <!-- User Info -->
              <div class="px-4 py-3 border-b border-gray-100">
                <p class="text-sm font-semibold text-gray-900">{{ user.name }}</p>
                <p class="text-xs text-gray-500 truncate">{{ user.email }}</p>
              </div>

              <!-- Menu Items -->
              <div class="py-1">
                <button
                  (click)="navigateToChangePassword()"
                  class="w-full text-left px-4 py-2 text-sm text-gray-700 hover:bg-gray-100 flex items-center gap-3 transition-colors">
                  <i class="pi pi-lock text-gray-400"></i>
                  <span>Change Password</span>
                </button>
                <button
                  (click)="logout()"
                  class="w-full text-left px-4 py-2 text-sm text-red-600 hover:bg-red-50 flex items-center gap-3 transition-colors">
                  <i class="pi pi-sign-out text-red-500"></i>
                  <span>Logout</span>
                </button>
              </div>
            </div>
          }
        </div>
      } @else {
        <a routerLink="/auth/login" 
           class="px-4 py-2 text-sm font-medium text-blue-600 hover:text-blue-700 transition-colors">
           Login
        </a>
        <a routerLink="/auth/register" 
           class="px-4 py-2 text-sm font-medium text-white bg-blue-600 hover:bg-blue-700 rounded-lg shadow-sm transition-all hover:shadow-md">
           Get Insured
        </a>
      }
    </div>
  </nav>
</header>