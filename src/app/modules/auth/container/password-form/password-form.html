<form [formGroup]="passwordForm" (ngSubmit)="onSubmit()" class="space-y-6">
  
  <!-- Current Password -->
  <div>
    <label for="oldPassword" class="block text-sm font-medium leading-6 text-gray-900">
      Current Password
    </label>
    <div class="mt-2">
      <input 
        id="oldPassword" 
        type="password" 
        formControlName="oldPassword"
        [class.ring-red-500]="isInvalid('oldPassword')"
        class="block w-full rounded-md border-0 px-3 py-1.5 text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 placeholder:text-gray-400 focus:ring-2 focus:ring-inset focus:ring-indigo-600 sm:text-sm sm:leading-6"
        placeholder="Enter your current password">
    </div>
    <p *ngIf="isInvalid('oldPassword')" class="mt-1 text-sm text-red-600">
      {{ getErrorMessage('oldPassword') }}
    </p>
  </div>

  <!-- New Password -->
  <div>
    <label for="newPassword" class="block text-sm font-medium leading-6 text-gray-900">
      New Password
    </label>
    <div class="mt-2">
      <input 
        id="newPassword" 
        type="password" 
        formControlName="newPassword"
        (focus)="onPasswordFocus()"
        (blur)="onPasswordBlur()"
        [class.ring-red-500]="isInvalid('newPassword')"
        class="block w-full rounded-md border-0 px-3 py-1.5 text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 placeholder:text-gray-400 focus:ring-2 focus:ring-inset focus:ring-indigo-600 sm:text-sm sm:leading-6"
        placeholder="Enter your new password">
    </div>
    <p *ngIf="isInvalid('newPassword')" class="mt-1 text-sm text-red-600">
      {{ getErrorMessage('newPassword') }}
    </p>
    
    <!-- Password Requirements Checklist -->
    <div *ngIf="showPasswordRequirements() || isInvalid('newPassword')" 
         class="mt-3 p-3 bg-gray-50 rounded-lg border border-gray-200">
      <p class="text-xs font-medium text-gray-700 mb-2">Password must contain:</p>
      <ul class="space-y-1">
        <li *ngFor="let req of passwordRequirements" 
            class="flex items-center text-xs"
            [class.text-green-600]="req.met"
            [class.text-red-500]="!req.met && isInvalid('newPassword')">
          <i class="pi mr-2 text-xs"
             [class.pi-check-circle]="req.met"
             [class.text-green-600]="req.met"
             [class.pi-times-circle]="!req.met"
             [class.text-red-500]="!req.met"></i>
          {{ req.label }}
        </li>
      </ul>
    </div>
  </div>

  <!-- Confirm Password -->
  <div>
    <label for="confirmPassword" class="block text-sm font-medium leading-6 text-gray-900">
      Confirm New Password
    </label>
    <div class="mt-2">
      <input 
        id="confirmPassword" 
        type="password" 
        formControlName="confirmPassword"
        [class.ring-red-500]="isInvalid('confirmPassword') || hasFormError('passwordMismatch')"
        class="block w-full rounded-md border-0 px-3 py-1.5 text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 placeholder:text-gray-400 focus:ring-2 focus:ring-inset focus:ring-indigo-600 sm:text-sm sm:leading-6"
        placeholder="Re-enter your new password">
    </div>
    <p *ngIf="isInvalid('confirmPassword')" class="mt-1 text-sm text-red-600">
      {{ getErrorMessage('confirmPassword') }}
    </p>
    <p *ngIf="hasFormError('passwordMismatch')" class="mt-1 text-sm text-red-600">
      Passwords do not match
    </p>
  </div>

  <!-- Submit Button -->
  <div>
    <button 
      type="submit" 
      [disabled]="passwordForm.invalid || isLoading"
      class="flex w-full justify-center rounded-md bg-indigo-600 px-3 py-1.5 text-sm font-semibold leading-6 text-white shadow-sm hover:bg-indigo-500 focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-indigo-600 disabled:opacity-50 disabled:cursor-not-allowed">
      <i *ngIf="isLoading" class="pi pi-spin pi-spinner mr-2"></i>
      {{ isLoading ? 'Updating...' : 'Change Password' }}
    </button>
  </div>
</form>
