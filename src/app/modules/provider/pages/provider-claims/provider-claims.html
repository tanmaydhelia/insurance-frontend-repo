<div class="bg-gray-50 py-8">
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
    
    <!-- Header -->
    <div class="md:flex md:items-center md:justify-between mb-8">
      <div class="min-w-0 flex-1">
        <h2 class="text-2xl font-bold leading-7 text-gray-900 sm:truncate sm:text-3xl sm:tracking-tight">
          Patient Claims
        </h2>
        <p class="mt-1 text-sm text-gray-500">View and track claims submitted through your hospital</p>
      </div>
      <div class="mt-4 flex md:ml-4 md:mt-0 gap-3">
        <a routerLink="/provider/dashboard"
          class="inline-flex items-center rounded-md bg-white px-3 py-2 text-sm font-semibold text-gray-700 shadow-sm ring-1 ring-inset ring-gray-300 hover:bg-gray-50 transition-all">
          <i class="pi pi-plus mr-2"></i>
          Submit New Claim
        </a>
        @if (selectedHospitalId()) {
          <button (click)="refreshClaims()"
            class="inline-flex items-center rounded-md bg-indigo-600 px-3 py-2 text-sm font-semibold text-white shadow-sm hover:bg-indigo-700 transition-all">
            <i class="pi pi-refresh mr-2"></i>
            Refresh
          </button>
        }
      </div>
    </div>

    <!-- Hospital Selector -->
    <div class="bg-white rounded-xl shadow-sm border border-gray-200 p-6 mb-6">
      <h3 class="text-lg font-medium text-gray-900 mb-4">Select Hospital</h3>
      <div class="max-w-md">
        <select 
          [ngModel]="selectedHospitalId()"
          (ngModelChange)="selectHospital($event)"
          class="block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 border px-3 py-2 text-sm">
          <option [value]="0">-- Select a Hospital --</option>
          @for (hospital of hospitals(); track hospital.id) {
            <option [value]="hospital.id">{{ hospital.name }}</option>
          }
        </select>
      </div>
    </div>

    @if (selectedHospitalId()) {
      <!-- Stats Cards -->
      <div class="grid grid-cols-2 md:grid-cols-4 lg:grid-cols-6 gap-4 mb-6">
        <div class="bg-white rounded-xl shadow-sm border border-gray-200 p-4">
          <p class="text-xs font-medium text-gray-500 uppercase">Total Claims</p>
          <p class="text-2xl font-bold text-gray-900 mt-1">{{ totalClaims() }}</p>
        </div>
        <div class="bg-white rounded-xl shadow-sm border border-gray-200 p-4">
          <p class="text-xs font-medium text-gray-500 uppercase">Submitted</p>
          <p class="text-2xl font-bold text-blue-600 mt-1">{{ submittedClaims() }}</p>
        </div>
        <div class="bg-white rounded-xl shadow-sm border border-gray-200 p-4">
          <p class="text-xs font-medium text-gray-500 uppercase">In Review</p>
          <p class="text-2xl font-bold text-yellow-600 mt-1">{{ inReviewClaims() }}</p>
        </div>
        <div class="bg-white rounded-xl shadow-sm border border-gray-200 p-4">
          <p class="text-xs font-medium text-gray-500 uppercase">Approved</p>
          <p class="text-2xl font-bold text-green-600 mt-1">{{ approvedClaims() }}</p>
        </div>
        <div class="bg-white rounded-xl shadow-sm border border-gray-200 p-4">
          <p class="text-xs font-medium text-gray-500 uppercase">Rejected</p>
          <p class="text-2xl font-bold text-red-600 mt-1">{{ rejectedClaims() }}</p>
        </div>
        <div class="bg-white rounded-xl shadow-sm border border-gray-200 p-4">
          <p class="text-xs font-medium text-gray-500 uppercase">Approved Amt</p>
          <p class="text-2xl font-bold text-indigo-600 mt-1">₹{{ totalApprovedAmount() | number:'1.0-0' }}</p>
        </div>
      </div>

      <!-- Filters -->
      <div class="bg-white rounded-xl shadow-sm border border-gray-200 p-4 mb-6">
        <div class="flex flex-col md:flex-row md:items-center gap-4">
          <!-- Search -->
          <div class="flex-1">
            <div class="relative">
              <div class="pointer-events-none absolute inset-y-0 left-0 flex items-center pl-3">
                <i class="pi pi-search text-gray-400"></i>
              </div>
              <input
                type="text"
                [ngModel]="searchQuery()"
                (ngModelChange)="updateSearchQuery($event)"
                placeholder="Search by diagnosis or claim ID..."
                class="block w-full rounded-md border-gray-300 pl-10 pr-3 py-2 border focus:border-indigo-500 focus:ring-indigo-500 text-sm">
            </div>
          </div>

          <!-- Status Filter Tabs -->
          <div class="flex flex-wrap gap-2">
            <button 
              (click)="setStatusFilter('ALL')"
              [class]="statusFilter() === 'ALL' ? 'bg-gray-900 text-white' : 'bg-gray-100 text-gray-700 hover:bg-gray-200'"
              class="px-3 py-1.5 rounded-full text-xs font-medium transition-colors">
              All ({{ totalClaims() }})
            </button>
            <button 
              (click)="setStatusFilter(ClaimStatus.SUBMITTED)"
              [class]="statusFilter() === ClaimStatus.SUBMITTED ? 'bg-blue-600 text-white' : 'bg-blue-100 text-blue-700 hover:bg-blue-200'"
              class="px-3 py-1.5 rounded-full text-xs font-medium transition-colors">
              Submitted ({{ submittedClaims() }})
            </button>
            <button 
              (click)="setStatusFilter(ClaimStatus.IN_REVIEW)"
              [class]="statusFilter() === ClaimStatus.IN_REVIEW ? 'bg-yellow-600 text-white' : 'bg-yellow-100 text-yellow-700 hover:bg-yellow-200'"
              class="px-3 py-1.5 rounded-full text-xs font-medium transition-colors">
              In Review ({{ inReviewClaims() }})
            </button>
            <button 
              (click)="setStatusFilter(ClaimStatus.APPROVED)"
              [class]="statusFilter() === ClaimStatus.APPROVED ? 'bg-green-600 text-white' : 'bg-green-100 text-green-700 hover:bg-green-200'"
              class="px-3 py-1.5 rounded-full text-xs font-medium transition-colors">
              Approved ({{ approvedClaims() }})
            </button>
            <button 
              (click)="setStatusFilter(ClaimStatus.REJECTED)"
              [class]="statusFilter() === ClaimStatus.REJECTED ? 'bg-red-600 text-white' : 'bg-red-100 text-red-700 hover:bg-red-200'"
              class="px-3 py-1.5 rounded-full text-xs font-medium transition-colors">
              Rejected ({{ rejectedClaims() }})
            </button>
          </div>
        </div>
      </div>

      <!-- Error Message -->
      @if (error()) {
        <div class="bg-red-50 border border-red-200 rounded-lg p-4 mb-6 flex items-center gap-3">
          <i class="pi pi-exclamation-circle text-red-600"></i>
          <span class="text-red-700">{{ error() }}</span>
        </div>
      }

      <!-- Claims Table -->
      <div class="bg-white shadow-sm ring-1 ring-gray-900/5 rounded-xl overflow-hidden">
        @if (isLoading()) {
          <div class="flex justify-center items-center py-20">
            <i class="pi pi-spin pi-spinner text-4xl text-indigo-600"></i>
          </div>
        } @else if (filteredClaims().length === 0) {
          <div class="text-center py-16">
            <i class="pi pi-inbox text-gray-300 text-5xl mb-4"></i>
            <h3 class="text-lg font-medium text-gray-900 mb-1">No claims found</h3>
            <p class="text-sm text-gray-500">
              @if (searchQuery() || statusFilter() !== 'ALL') {
                Try adjusting your filters
              } @else {
                No claims have been submitted through this hospital yet
              }
            </p>
          </div>
        } @else {
          <div class="overflow-x-auto">
            <table class="min-w-full divide-y divide-gray-200">
              <thead class="bg-gray-50">
                <tr>
                  <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                    Claim ID
                  </th>
                  <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                    Date
                  </th>
                  <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                    Diagnosis
                  </th>
                  <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                    Claim Amount
                  </th>
                  <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                    Approved Amount
                  </th>
                  <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                    Status
                  </th>
                  <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                    Document
                  </th>
                </tr>
              </thead>
              <tbody class="bg-white divide-y divide-gray-200">
                @for (claim of filteredClaims(); track claim.id) {
                  <tr class="hover:bg-gray-50 transition-colors">
                    <td class="px-6 py-4 whitespace-nowrap">
                      <span class="text-sm font-medium text-gray-900">#{{ claim.id }}</span>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap">
                      <span class="text-sm text-gray-600">{{ claim.date | date:'mediumDate' }}</span>
                    </td>
                    <td class="px-6 py-4">
                      <p class="text-sm text-gray-900 max-w-xs truncate" [title]="claim.diagnosis">
                        {{ claim.diagnosis }}
                      </p>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap">
                      <span class="text-sm font-semibold text-gray-900">
                        ₹{{ claim.claimAmount | number:'1.0-0' }}
                      </span>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap">
                      @if (claim.status === ClaimStatus.APPROVED && claim.approvedAmount !== undefined) {
                        <span class="text-sm font-semibold text-green-600">
                          ₹{{ claim.approvedAmount | number:'1.0-0' }}
                        </span>
                      } @else {
                        <span class="text-sm text-gray-400">—</span>
                      }
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap">
                      <span [class]="getStatusColor(claim.status)" 
                            class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium">
                        <i [class]="'pi ' + getStatusIcon(claim.status)" class="mr-1 text-xs"></i>
                        {{ claim.status }}
                      </span>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap">
                      @if (claim.documentUrl) {
                        <a [href]="claim.documentUrl" target="_blank" 
                           class="text-indigo-600 hover:text-indigo-800 text-sm font-medium">
                          <i class="pi pi-file mr-1"></i>View
                        </a>
                      } @else {
                        <span class="text-sm text-gray-400">None</span>
                      }
                    </td>
                  </tr>

                  <!-- Rejection Reason Row -->
                  @if (claim.status === ClaimStatus.REJECTED && claim.rejectionReason) {
                    <tr class="bg-red-50">
                      <td colspan="7" class="px-6 py-3">
                        <p class="text-sm text-red-700">
                          <strong>Rejection Reason:</strong> {{ claim.rejectionReason }}
                        </p>
                      </td>
                    </tr>
                  }

                  <!-- Approval Comments Row -->
                  @if (claim.status === ClaimStatus.APPROVED && claim.approvalComments) {
                    <tr class="bg-green-50">
                      <td colspan="7" class="px-6 py-3">
                        <p class="text-sm text-green-700">
                          <strong>Approval Comments:</strong> {{ claim.approvalComments }}
                        </p>
                      </td>
                    </tr>
                  }
                }
              </tbody>
            </table>
          </div>

          <!-- Summary Footer -->
          <div class="px-6 py-4 bg-gray-50 border-t border-gray-200">
            <div class="flex justify-between items-center text-sm text-gray-600">
              <span>Showing {{ filteredClaims().length }} of {{ totalClaims() }} claims</span>
              <span class="font-medium">
                Total Claimed: ₹{{ totalClaimAmount() | number:'1.0-0' }}
              </span>
            </div>
          </div>
        }
      </div>
    } @else {
      <!-- No Hospital Selected -->
      <div class="bg-white rounded-xl shadow-sm border border-gray-200 p-16 text-center">
        <i class="pi pi-building text-gray-300 text-6xl mb-4"></i>
        <h3 class="text-lg font-medium text-gray-900 mb-2">Select a Hospital</h3>
        <p class="text-sm text-gray-500 max-w-md mx-auto">
          Choose a hospital from the dropdown above to view all claims submitted through that facility.
        </p>
      </div>
    }
  </div>
</div>
